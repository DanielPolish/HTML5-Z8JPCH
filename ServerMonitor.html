<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Server monitor</title>

<link rel="stylesheet"
	href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
	integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2"
	crossorigin="anonymous">

<!--<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
	integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
	crossorigin="anonymous"></script>-->
	<script src = "https://code.jquery.com/jquery-1.10.2.js"></script>
<script
	src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
	integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
	crossorigin="anonymous"></script>
<link href = "https://code.jquery.com/ui/1.12.1/themes/ui-lightness/jquery-ui.css"
   rel = "stylesheet">
   
<script src = "https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<link rel="stylesheet" href="monitorstyle.css">
	
	
</head>

<script type="text/javascript" src="GameGetter.js"></script>
<script type="text/javascript" src="MapManager.js"></script>
<body>
	<div class="header flex-row d-flex justify-content-between bg-dark">
		<div id="gamename"
			class="text-light d-flex align-items-center justify-content-center">Flight
			Simulator Server Monitor</div>
		<div>
			<a href="https://play.google.com/store/apps/details?id=com.danielpolish.vrflight" class="btn text-primary d-flex align-items-center">Download
				game</a>
		</div>
	</div>

	

	<div id="main"
		class="main d-flex align-items-center justify-content-center">
			<div id="mapContainer" class="mapContainer">
				<img id="mapImage" class="mapImage" alt="map" src="maps/1_ld.jpg" draggable="false"/>
				<!-- <button type="button" class="btn btn-primary backBtn" onclick="LoadGames(5)">Back</button> -->
				<!-- <button type="button" class="btn btn-primary backBtn" onclick="LoadGames(5)">Back</button> -->
				
				<div id="planeTransform-1" class="backbtn nopad">
					<button type="button" class="btn backBtn" onclick="LoadGames(5)"><img alt="Back" src="ui/exit.png" class="backbtnimage"></button>
				</div>
				
				<div id="planeTransform0" class="planeTransform nopad">
					<div id="planeImageContainer0" class="planeImageContainer nopad" title="Plane #0">
						<img id="planeImage0" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor0_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor0_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform1" class="planeTransform nopad">
					<div id="planeImageContainer1" class="planeImageContainer nopad" title="Plane #1">
						<img id="planeImage1" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor1_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor1_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform2" class="planeTransform nopad">
					<div id="planeImageContainer2" class="planeImageContainer nopad" title="Plane #2">
						<img id="planeImage2" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor2_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor2_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform3" class="planeTransform nopad">
					<div id="planeImageContainer3" class="planeImageContainer nopad" title="Plane #3">
						<img id="planeImage3" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor3_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor3_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform4" class="planeTransform nopad">
					<div id="planeImageContainer4" class="planeImageContainer nopad" title="Plane #4">
						<img id="planeImage4" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor4_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor4_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform5" class="planeTransform nopad">
					<div id="planeImageContainer5" class="planeImageContainer nopad" title="Plane #5">
						<img id="planeImage5" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor5_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor5_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
				<div id="planeTransform6" class="planeTransform nopad">
					<div id="planeImageContainer6" class="planeImageContainer nopad" title="Plane #6">
						<img id="planeImage6" class="planeImage" alt="plane0" src="planes/plane3.png">
						<img id="planeColor6_0" class="planeColor" alt="plane0" src="planes/plane3_mat0.png">
						<img id="planeColor6_1" class="planeColor" alt="plane0" src="planes/plane3_mat1.png">
					</div>
				</div>
			</div>
			
		
		<div id="gamelistContainer" class="container">
			<div class="row font-weight-bold gridHead">
				<div class="col">Room ID</div> <div class="col">Version <div class="btn nopad" onclick="openVersionFilter()"><img id="versionFilter" class="sortIcon" alt="F" src="ui/filter.png"></div></div> <div class="col">Game mode</div> <div class="col">Status</div> <div class="col">Players</div>
			</div>
			<div class="row nopad overflow-auto gameList">
				<div id="gamelist" class="container noVpad">
					<div class="row gridData" onclick="gameClick(117)">
						<div class="col">112</div> <div class="col">6</div> <div class="col">FreeFlight</div> <div class="col">Idol</div> <div class="col">0/4</div>
					</div>
					<div class="row gridData" onclick="gameClick(117)">
						<div class="col">113</div> <div class="col">7</div> <div class="col">Star collector</div> <div class="col">Active</div> <div class="col">2/4</div>
					</div>
					<div class="row gridData" onclick="gameClick(117)">
						<div class="col">114</div> <div class="col">8</div> <div class="col">Star collector</div> <div class="col">Idol</div> <div class="col">0/4</div>
					</div>
					<div class="row gridData" onclick="gameClick(117)">
						<div class="col">115</div> <div class="col">8</div> <div class="col">FreeFlight</div> <div class="col">Active</div> <div class="col">5/6</div>
					</div>
					<div class="row gridData" onclick="gameClick(117)">
						<div class="col">116</div> <div class="col">6</div> <div class="col">FreeFlight</div> <div class="col">Idol</div> <div class="col">0/4</div>
					</div>
					<div class="row gridData">
						<div class="col">To get live data, open this document from danielpolish.hu.</div>
					</div>
				</div>
			</div>
			
			<div class="row gridFeet">
				<div class="col"><div id="sortname" class="btn nopad" onclick="setSorting('name')">V</div></div>
				<div class="col"><div id="sortver" class="btn nopad" onclick="setSorting('ver')">V</div> </div>
				<div class="col"><div id="sortmode" class="btn nopad" onclick="setSorting('mode')">V</div> </div>
				<div class="col"><div id="sortstate" class="btn nopad" onclick="setSorting('state')">V</div> </div>
				<div class="col"><div id="sortslots" class="btn nopad" onclick="setSorting('slots')">V</div></div>
			</div>
		</div>
		
		
		<!-- <template id="gamelist"> -->
		<!-- <table class="table text-center table-hover">
			<tr>
			<th>Room ID</th> <th>Game mode</th> <th>State</th> <th>Players</th> <th> </th>
			</tr>
			<tr>
			<td>112</td> <td>Freeflight</td> <td>Idol</td> <td>0/4</td> <td><a href="#" class="btn text-primary">Check></a></td>
			</tr>
			<tr>
			<td>113</td> <td>Star collector</td> <td>Active</td> <td>2/4</td> <td><a href="#" class="btn text-primary">Check></a></td>
			</tr>
		</table> -->
		<!-- </template> -->
	</div>

	<div
		class="footer flex-row d-flex align-items-end justify-content-center bg-dark">
		<div class="text-light d-flex align-items-center">(c)
			DanielPolish.hu</div>
	</div>
	
	<div id="dialog-form" title="Filter by version" class="nopad">
		<div class="flex-row d-flex align-items-center justify-content-between vf-title nopad">
			<div >Filter by version</div>
	    	<button type="button" id="closevfbtn" class="btn" onclick="closeVersionFilter()"><img alt="-" src="ui/close.png"></button>
	    </div>
	    <div>
	      <div class="flex-row d-flex align-items-center justify-content-center">
	      <button type="button" id="decverbtn" class="btn" onclick="decVersion()"><img alt="-" src="ui/dec.png"></button> 
	      <!-- <input type="number" name="versionfilter" id="versionfilter" value="0" class="text ui-widget-content ui-corner-all">-->
	      
	      <div><label id="versionfilter">0</label></div>
	      <button type="button" id="incverbtn" class="btn" onclick="incVersion()"><img alt="-" src="ui/inc.png"></button>
	      </div>
	    </div>
	    <div class="flex-row d-flex align-items-center justify-content-around">
	    	<button type="button" id="applyvfbtn" class="btn vfbtn" onclick="setVersionFilter()">Apply</button>
	    	<button type="button" id="clearvfbtn" class="btn vfbtn" onclick="clearVersionFilter()">Clear</button>
	    </div>
	</div>
	
	<script type="text/javascript">
	var dialog;
	
	$(document).ready(function(){
		$( document ).tooltip();
		
		$("#versionFilter").css("opacity", "0.5");
		InitStorage();
		setSortIcons(localStorage.sortgamesby, localStorage.sortgamesdesc);
		setVersionIcon();
		LoadGames(5);
		var map = document.getElementById("mapContainer");
		map.addEventListener("wheel", ScaleMap);
		map.addEventListener("mousedown", MouseDownOnMap);
		map.addEventListener("mouseup", MouseUpOnMap);
		map.addEventListener("mousemove", MouseMoveOnMap);
		map.addEventListener("mouseleave", MouseLeavesMap);
		
		mapImage = document.getElementById("mapImage");
		mapImage.addEventListener("mousedown", MouseDownOnMap);
		mapImage.addEventListener("mouseup", MouseUpOnMap);
		mapImage.addEventListener("mousemove", MouseMoveOnMap);
	});
	
	function InitStorage() {
		if (!localStorage.sortgamesby)
			localStorage.sortgamesby = "name";
		if (!localStorage.sortgamesdesc)
			localStorage.sortgamesdesc = "true";
		if (!localStorage.gameversionfilter)
			localStorage.gameversionfilter = "0";
	}
	
	function LoadMap(gameID, mode) {
		StopGameQuery();
		
		
		var mapImage = document.getElementById("mapImage");
		mapImage.setAttribute("src", "maps/" + mode + "_ld.jpg");
		
		var map = document.getElementById("mapContainer");
		map.style.display = "block";
		var list = document.getElementById("gamelistContainer");
		list.style.display = "none";
		StartMapManager(gameID);
	}
	
	function LoadGames(version) {
		StopMapManager();
		StartGameQuery(version);
		
		var map = document.getElementById("mapContainer");
		map.style.display = "none";
		var list = document.getElementById("gamelistContainer");
		list.style.display = "block";
	}

	function openVersionFilter() {
		dialog.dialog("open");
		dialog.prev(".ui-dialog-titlebar").attr("hidden",true);// .css("background","#cccccc").css("color", "black");
		$("#dialog-form").css("padding", "0").parent().css("padding", "0").css("border", "3px solid #cccccc").css("border-radius", "12px");
		$(".ui-resizable-handle").attr("hidden", true);
		//dialog.prev(".ui-dialog-titlebar-close").css("background","#cccccc").css("color", "black");
		var vers = localStorage.gameversionfilter;
		$("#versionfilter").html(parseInt(vers));
		console.log("Loaded version: " + vers);
		disableVerButtons(vers);
	}
	
	function closeVersionFilter() {
		dialog.dialog("close");
	}
	
	function decVersion() {
		var versfilter = $("#versionfilter");
		var versraw = versfilter.html();
		var newvers = 0;
		if (!isNaN(versraw)) {
			var vers = parseInt(versraw);
			newvers = vers - 1;
		}
		versfilter.html(newvers);
		disableVerButtons(newvers);
	}
	
	function incVersion() {
		var versfilter = $("#versionfilter");
		var versraw = versfilter.html();
		var newvers = 0;
		if (!isNaN(versraw)) {
			var vers = parseInt(versraw);
			newvers = vers + 1;
		}
		versfilter.html(newvers);
		disableVerButtons(newvers);
	}
	
	function disableVerButtons(version) {
		if (version <= 1) {
			$("#decverbtn").attr("disabled", true);
			$("#incverbtn").attr("disabled", false);
		} else {
			$("#decverbtn").attr("disabled", false);
			$("#incverbtn").attr("disabled", false);
		}
	}
	
	function setVersionIcon() {
		var ver = parseInt(localStorage.gameversionfilter);
		if (ver > 0) {
			$("#versionFilter").css("opacity", "1");
		} else {
			$("#versionFilter").css("opacity", "0.5");
		}
	}
	
	/*function setVersionFilter() {
		var ver = localStorage.gameversionfilter;
		if (ver === "0") {
			ver = "5";
			$("#versionFilter").css("opacity", "1");
		} else {
			ver = "0";
			$("#versionFilter").css("opacity", "0.5");
		}
		
		localStorage.gameversionfilter = ver;
		RestartGameWorker();
	}*/
	
	function setSorting(sortBy) {
		if (localStorage.sortgamesby == sortBy) {
			var desc = localStorage.sortgamesdesc === "true";
			localStorage.sortgamesdesc = !desc;
		} else {
			localStorage.sortgamesby = sortBy;
			localStorage.sortgamesdesc = "true";
		}
		
		setSortIcons(localStorage.sortgamesby, localStorage.sortgamesdesc);
		SortGames();
	}
	
	function setSortIcons(sortBy, desc) {
		resetSortIcons();
		
		var sortIconUp = "<img class=\"sortIcon\" alt=\"A\" src=\"ui/up.png\">";
		var sortIconDown = "<img class=\"sortIcon\" alt=\"V\" src=\"ui/down.png\">";
		$("#sort" + sortBy).html(desc === "true"? sortIconDown : sortIconUp).css("opacity", "1").css("font-weight", "bold");
	}
	
	function resetSortIcons() {
		var sortIcon = "<img class=\"sortIcon\" alt=\"V\" src=\"ui/down.png\">";
		$("#sortname").html(sortIcon).css("opacity", "0.5").css("font-weight", "normal");
		$("#sortver").html(sortIcon).css("opacity", "0.5").css("font-weight", "normal");
		$("#sortmode").html(sortIcon).css("opacity", "0.5").css("font-weight", "normal");
		$("#sortstate").html(sortIcon).css("opacity", "0.5").css("font-weight", "normal");
		$("#sortslots").html(sortIcon).css("opacity", "0.5").css("font-weight", "normal");
	}
	
	function setVersionFilter() {
		var vers = $("#versionfilter").html();
		if (!isNaN(vers)) {
			if (parseInt(vers) > 0) {
				console.log("setVersionFilter: " + vers);
				localStorage.gameversionfilter = vers;
				RestartGameWorker();
			}
		}
		setVersionIcon();
		dialog.dialog("close");
	}
	
	function clearVersionFilter() {
		localStorage.gameversionfilter = "0";
		console.log("clearVersionFilter");
		RestartGameWorker();
		setVersionIcon();
		dialog.dialog("close");
	}
	
	dialog = $( "#dialog-form" ).dialog({
	      autoOpen: false,
	      //height: 300,
	      //width: 300,
	      modal: true,
	      //buttons: {
	      //  "Apply": setVersionFilter,
	      //  "Clear": clearVersionFilter
	      //},
	      close: function() {
	        //form[ 0 ].reset();
	        //allFields.removeClass( "ui-state-error" );
	      }
	    });
	
	
	 
	    /*form = dialog.find( "form" ).on( "submit", function( event ) {
	      event.preventDefault();
	      addUser();
	    });
	 
	    $( "#create-user" ).button().on( "click", function() {
	      dialog.dialog( "open" );
	    });*/
	</script>
</body>
</html>